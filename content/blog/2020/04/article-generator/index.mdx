---
title: Gatsbyã®è¨˜äº‹é››å½¢ã‚’è‡ªä½œCLIã§ã‚µã‚¯ãƒƒã¨ç”Ÿæˆã™ã‚‹
date: '2020-04-25'
tags: ['Gatsby', 'CLI']
---

Gatsby ã§è¨˜äº‹ã‚’æ›¸ã“ã†ã¨ã—ãŸã¨ãã€æ¯å›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã£ãŸã‚Šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã®ã¯ã ã‚‹ã„ã€‚  
ã‚‚ã—ã‹ã—ãŸã‚‰ãã®æ‰‹é–“ã®ã›ã„ã§ãƒ¢ãƒãƒ™ãŒè‘—ã—ãä½ä¸‹ã—ã€è¨˜äº‹ã‚’æ›¸ãæ©Ÿä¼šã®æå¤±ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ãã“ã§ã€ãã®æ‰‹é–“ã‚’æŠ‘ãˆã‚‹ãŸã‚ã®ç°¡å˜ãª CLI ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ãŸã€‚

## ä»Šå›ã®æˆæœç‰©

`vue-cli` ã¨ã‹ `nest-cli` ã®ã‚ˆã†ãªã€Œå¯¾è©±å¼ CLIã€ã®ã—ã‚‡ã¼ã„ç‰ˆ 

![](c5617167.png)

https://github.com/hasegayo/web/tree/master/generator

## æ–¹é‡
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(.mdx)ã‚’ç”¨æ„ã—ã€å¿…è¦ç®‡æ‰€ã‚’ç½®æ›ã—ã¦ä»»æ„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ›¸ãå‡ºã™
- ãªã‚‹ã¹ãã‚³ãƒ¼ãƒ‰é‡ã‚’å°‘ãªãæ¥½ã—ãŸã„ã®ã§è‰¯ã•ã’ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã™
- npm-scripts ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹

## èª¿æŸ»
CLI ãƒ„ãƒ¼ãƒ«ã®ä½œæˆã«å¿…è¦ãã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§ã¯ä»¥ä¸‹ã®è¨˜äº‹ã«è‰¯ãã¾ã¨ã¾ã£ã¦ã„ãŸã€‚
- [Node.jsã§ã®CLIã®ä½œã‚Šæ–¹ã¨ä¾¿åˆ©ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¾ã¨ã‚ - Qiita](https://qiita.com/toshi-toma/items/ea76b8894e7771d47e10#minimist)

ã“ã®ä¸­ã§**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆå¯¾è©±å¼ï¼‰ã«å€¤ã‚’å…¥åŠ›ã§ãã‚‹ã‚‚ã®**ã‚’æ¡ä»¶ã¨ã—ã¦æ¢ã—ãŸã¨ãã€ **[SBoudrias/Inquirer.js](https://github.com/SBoudrias/Inquirer.js/)** ãŒè¦ä»¶ã‚’æº€ãŸã—ã¦ã„ãŸã€‚

## å®Ÿè£…
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚
- root
  - generator
    - index.js
    - template.mdx

slug ã‚’å…¥åŠ›ã—ãŸã‚‰ `content/blog/${yyyy}/${mm}/${slug}` ã« `index.mdx` ã‚’åãã ã‘ã€‚
- generator/index.js
```js
const inquirer = require("inquirer");
const fse = require('fs-extra');  // mkdirp (mkdir -p) ã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§

const now = new Date();
const yyyy = now.getFullYear();
const mm = ("0"+(now.getMonth()+1)).slice(-2);
const dd = ("0"+now.getDate()).slice(-2);
const baseSlug = `blog/${yyyy}/${mm}`

const questions = [
  {
    type: 'input',
    name: 'slug',
    message: `slug: ${baseSlug}/`,
    validate: function(value) {
      if (value.match(/^[a-z-]+$/i)) {
        return true;
      }
      return 'Allow only "kebab-case"';
    }
  }
];

(async () => {
  // answers ã«ã¯ questions ã®çµæœãŒ { [${name}]: ${input} } å½¢å¼ã§å…¥ã£ã¦ã„ã‚‹
  const answers = await inquirer.prompt(questions);
  const { slug } = answers;
  const generateDir = `content/${baseSlug}/${slug}`;
  await fse.mkdirp(generateDir);
  const template = await fse.readFile(`generator/template.mdx`);
  const newMdx = template.toString().replace("${date}", `${yyyy}-${mm}-${dd}`);
  await fse.writeFile(`${generateDir}/index.mdx`, newMdx);

  console.log(`ğŸ“™ Generated!: ${generateDir}/index.mdx`);
})();
```

- template.mdx
```mdx
---
title:
date: '${date}'
tags: []
---

## æ„Ÿæƒ³
```

npm script ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã€‚
- package.json
```json
{
  ...
  "scripts": {
    "g": "node generator",
```

## æ„Ÿæƒ³
ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®å…¥åŠ›å€¤ã‚’èª­ã¿å–ã‚‹æ³¥è‡­ã„å‡¦ç†ã‚’æ›¸ãå¿…è¦ãŒãªãç°¡å˜ã«å®Ÿè£…ã§ããŸã€‚
`inquirer.js` ã® [README.md](https://github.com/SBoudrias/Inquirer.js/#prompt-types) ã‚’èª­ã‚ã°ã‚ã‹ã‚‹ãŒã€å…¥åŠ›ã‚¿ã‚¤ãƒ—ã‚‚ `List` ã‚„ `Checkbox` ãªã©è±Šå¯Œã§ã‚ã‚‹ã€‚
ã„ã¡ã°ã‚“æ°—ã«å…¥ã£ã¦ã„ã‚‹ã¨ã“ã‚ã¯ã€ç‰¹åˆ¥ãªå‡¦ç†ã‚’ã„ã‚Œãªãã¦ã‚‚æ–‡å­—è‰²ãŒã„ã„æ„Ÿã˜ã«ã¤ã„ã¦ãã‚Œã‚‹ã¨ã“ã‚ã ã£ãŸã‚Šã™ã‚‹ã€‚
